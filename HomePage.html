<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Page</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="custom.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
      crossorigin="anonymous"
    />
    <style>
      footer{
        text-align: center;
        padding-top: 250px;
      }
    </style>
  </head>
  <body class="text-center p-5">
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="HomePage.html">Children Info System</a>
        <div class="ms-auto d-flex align-items-center">
          <span class="me-3 text-secondary"
            >Logged in as: <strong id="navUsername"></strong
          ></span>
          <button id="logoutBtn" class="btn btn-outline-danger btn-sm">
            <i class="bi bi-box-arrow-right"></i> Logout
          </button>
        </div>
      </div>
    </nav>

    <h1 class="mb-4">CHILDREN INFORMATION SYSTEM</h1>

    <div class="d-grid gap-3 col-6 mx-auto">
      <a href="index.html" class="btn btn-primary"
        ><i class="bi bi-person-plus"></i>Add New Student</a
      >
      <a href="display.html" class="btn btn-secondary"
        ><i class="bi bi-list-ul"></i>Display the Students</a
      >
    </div>

    <footer>
      <p class="mb-3" id="faith">Copyright &copy; 2025 All rights reserved | FAITH HOME | Made by Swarna</p>
    </footer>
  </body>

  <script>
    const token = localStorage.getItem("token");

    if (!token) {
      window.location.href = "login.html";
    } else {
      try {
        const payload = JSON.parse(atob(token.split(".")[1]));

        // Check token expiry
        const expiry = payload.exp * 1000;
        if (Date.now() > expiry) {
          alert("Session expired. Please log in again.");
          localStorage.removeItem("token");
          window.location.href = "login.html";
        } else {
          // Display username in nav bar
          const navUsername = document.getElementById("navUsername");
          if (navUsername) {
            navUsername.textContent = payload.username;
          }
        }
      } catch (e) {
        console.error("Invalid token", e);
        localStorage.removeItem("token");
        window.location.href = "login.html";
      }
    }

    // Logout handler
    document.getElementById("logoutBtn")?.addEventListener("click", () => {
      localStorage.removeItem("token");
      window.location.href = "login.html";
    });
  </script>
</html>
